---
layout: post
title: 树莓派的系统 TF 卡制作，添加 SSH 功能以及 root 用户 ssh 登陆
date: 2019-12-05
description: 拿到一个新的树莓派应该怎么操作
tag: 树莓派
---

_由于官网改版，一些图片以及一些操作在 2020/05/31 更新_

- [树莓派系统盘 - TF 卡制作准备](#树莓派系统盘---tf-卡制作准备)
  - [1. 进入树莓派系统的官方下载页面<br>](#1-进入树莓派系统的官方下载页面)
  - [2. 下载需要的系统（以 Raspbain 为栗）](#2-下载需要的系统以-raspbain-为栗)
  - [3. 下载烧录软件 Win32DiskImager](#3-下载烧录软件-win32diskimager)
  - [4. 下载硬盘管理工具 DiskGenius](#4-下载硬盘管理工具-diskgenius)
- [树莓派系统盘 - TF 卡制作](#树莓派系统盘---tf-卡制作)
  - [1. 初始化【可以不做](#1-初始化可以不做)
  - [2. 烧录系统](#2-烧录系统)
  - [3. 打开 SSH 功能](#3-打开-ssh-功能)
- [登陆树莓派](#登陆树莓派)
  - [连接准备](#连接准备)
  - [查找 ip](#查找-ip)
  - [连接工具](#连接工具)
  - [连接树莓派](#连接树莓派)
- [使用root用户连接【可不做](#使用root用户连接可不做)
  - [设置 root 用户的密码](#设置-root-用户的密码)
  - [配置允许使用 root 用户 ssh 连接<br>](#配置允许使用-root-用户-ssh-连接)

### 树莓派系统盘 - TF 卡制作准备
#### 1. 进入树莓派系统的[官方下载页面](https://www.raspberrypi.org/downloads/)<br>
不想看系统介绍的可以直接查看第二步~
![树莓派官方推荐系统](/images/20191205/raspberrypi-system1.png)<br>
![树莓派第三方系统](/images/20191205/raspberrypi-system2.png)<br>
> 树莓派有很多系统（但都是专用的，只能使用官网上的系统），这里借用小手册上的一些介绍：
> * NOOBS: 官方推荐，这是一个多系统引导管理器，可以引导多种系统的安装。【应该来说一般不会用得上
> * Raspbian: 官方推荐，基于 Debian 系统专门位卡片式计算机树莓派定制的版本，应该来说是树莓派用户最广泛使用的系统。国内更新源多，软件丰富，系统稳定，对于新手和老手使用起来都很顺手。其他的第三方系统各有偏重，而 Raspbain 在各方面比较平衡，因此它是官方首选系统，强力推荐新手使用此系统对树莓派进行熟悉入门和操作学习等。
> * Ubuntu Mate: 使用 Ubuntu ARM 版本，Gnome2 桌面，熟悉 Ubuntu 的用户可以尝试。
> * Ubuntu Core: 面向智能设备的一个 Ubuntu 版本，可以运行储存在本地或依赖于云端的相同软件，可以避免使用者频繁更新。
> * Windows 10 IoT Core: 主要应用于智能设备和使用物联网的设备，例如工业电脑、智能网关等。硬件也不仅仅限于 x86 架构，同时可以在 ARM 架构上运行。
> * OSMC: Open Source Media Cente 是一个开源的媒体中心，可以播放本地和互联网上的次元。项目始于 2014 年，基于 Debian 和 Kodi 项目构建。前身是 Raspbmc 集成 Kodi(XMBC/Xbox Media Center)，目的是打造一个多媒体中心，可以配合电视机打造一个家庭高清电视播放平台。（感觉很有用的亚子=w=）
> * RISC OS: RISC OS 于 1987 年首次发布，是被专门设计运行在 ARM 芯片上由命令行和环境桌面组成的视窗系统。<br><br>
> 还有很多其他第三方系统，各有优劣，这里我只简单介绍了一下官网上列出来的而且手册上也有的。猹还是推荐相对不是很熟悉树莓派的同学，还是使用 Raspbain 叭，这个我用起来还是很舒服的，用户量大，网上介绍、解决问题的教程什么的也比较多。

#### 2. 下载需要的系统（以 Raspbain 为栗）
 1. 点击进入 Raspbain 的下载页面<br>
 ![系统下载步骤1](/images/20191205/install-step1.png)<br>
 2. 下滑找到下载链接，第一个是图形化界面加常用软件，第二个是图形界面，第三个是仅系统核心没有图形界面的命令行版本【第三个显然是最好用的辣=w=<br>
 可以直接点击下载 zip 压缩包，~~也可以先下载迅雷链接，然后再使用迅雷下载（迅雷下载会快一点）~~ 现在迅雷不能用了，没有迅雷还则罢了，有的话最好在迅雷设置里把“接管浏览器”给取消掉，用浏览器才能下载（猹是这个情况）<br>
 ![系统下载步骤2](/images/20191205/install-step2.png)

#### 3. 下载烧录软件 [Win32DiskImager](https://sourceforge.net/projects/win32diskimager/)
点击 Download 按钮后等几秒就开始下载了

![烧录软件下载页面](/images/20191205/download-win32diskimager.png)

#### 4. 下载硬盘管理工具 [DiskGenius](http://www.diskgenius.cn/download.php)
中文界面就不截图了，下载系统对应版本即可（网页甚至会提示你适合用哪个版本 32/64）<br>
这个工具可以对硬盘进行格式化，分区，坏道检测等操作，因为有的 SD 卡可能会被乱格式化过，导致 Win32DiskImager 无法识别从而无法烧录系统。所以我当时就用这个工具对 SD 卡格式化并重新分区，分一个区并且把磁盘格式设置为 FAT32 。这样一来 TF 卡就初始化好了，再去 Win32DiskImager 里看就能识别出那个卡了。

工具全部准备好后应该是这些：
* 树莓派系统 Raspbain 镜像，下面是解压出来的 ".img" 文件
* Win32DiskImager 工具
* ~~可能用不到的~~ DiskGenius 工具，因为是免安装的工具，解压出来就能用

![准备文件](/images/20191205/softwares.png)

### 树莓派系统盘 - TF 卡制作
#### 1. 初始化【可以不做
这里因为我不想再把我的卡初始化一遍了，所以就大概说一下，还是不会的可以私信哈（页面最下方有我的邮箱和各个社交平台的账号，推荐 csdn 和 b站）（还有，数据无价 谨慎操作）
1. 选中你的卡（注意是整个卡而不是卡下面的某个分区）右键
2. 删除所有分区
3. 选中卡，点上面的新建分区选择文件系统类型为 **FAT32** ![新建分区](/images/20191205/newarea.png)
4. 确定~~我不是故意④步的QAQ~~

ps: 如果在第二步👇烧系统的时候出现错误建议用 DiskGenius 重新格式化一下 SD 卡。

#### 2. 烧录系统
1. 双击运行 Win32DiskImager 安装程序进行软件安装
2. 运行系统烧录程序![Win32DiskImager](/images/20191205/win32diskimagerunprogram.png)
3. 按步骤烧录系统<br>![烧录步骤](/images/20191205/maketfcard.png)
4. 烧录完成后点击 **退出** 结束

这时你可以看到那个卡里多了很多文件，就是 Raspbain 系统默认的文件

#### 3. 打开 SSH 功能
在系统卡（TF 卡）的根目录下添加一个 **无后缀，名字是 SSH 的文件**<br>
我的文件内容和各位的可能不愿意，因为我这个卡已经用过一段时间了，只要注意最下面那个名叫 SSH 的文件即可，创建方法可以是 `新建一个文本文档，然后把后缀 .txt 删掉`<br>
![添加 SSH 文件](/images/20191205/addsshfile.png)<br>
ps: 我其实之前就添加过一次，不过今天拿出来看之前添加的 SSH 文件不见了，这个操作是我多年前使用树莓派时使用的操作，反正功能是正常可以使用的，不知道是本来就会消失还是说新版本的系统不需要这个操作了，有兴趣研究的可以自己重新刷一个卡然后试试加和不加的区别，没兴趣的话就照着猹的步骤做吧。

这之后就可以吧卡插上，插上电源网线对树莓派为所欲为辣<br>
什么？你不会为所欲为？那继续往下看叭~

### 登陆树莓派
#### 连接准备
确保你有一个可以自己登陆的路由器，将树莓派通过网线连接到路由器的一个 LAN 口，再将一个手机或者电脑通过有线或者无线的方式连接上同一个路由器的网络，然后打开浏览器在地址栏输入路由器的内网ip（通常是 192.168.1.1）进入路由器管理页面查看一下树莓派的内网ip。

#### 查找 ip
一般来说树莓派默认的 客户端名 就是 "raspberrypi" 或者 "raspberry" 不过我这边就显示怪怪的，如果你有一定的网络连接方面的知识，你是可以找到它的，如果没有. . . 那就一个一个连接一遍来尝试吧=w=

#### 连接工具
手机上的 SSH 工具最好用的就是 JuiceSSH ，电脑上的有 FinalShell, Xshell 等。~~我最开始知道的 PC 端 SSH 工具还是 Putty 233~~

#### 连接树莓派
以最近猹经常用的 FinalShell 为例[下载地址](http://www.hostbuf.com/downloads/finalshell_install.exe)：
新建 SSH 连接，默认可以登陆的用户名是 pi 密码是 raspberry<br>
![新建SSH连接](/images/20191205/addshhlink.png)
![SSH设置](/images/20191205/sshsetting.png)

### 使用root用户连接【可不做
因为 **root** 用户有管理员权限，超级用户可以对系统内文件进行任何操作，有时做一些事情会比较方便，默认 root 用户是没有密码的
#### 设置 root 用户的密码
普通用户也可以使用 `sudo` 命令来临时获得管理员权限，我们可以用 `passwd` 命令来修改 root 用户的密码，之后我们就可以直接用 root 用户来登陆树莓派辣
```sh
pi@raspberrypi:~ $ sudo passwd root
New password:
Retype new password:
passwd: password updated successfully
pi@raspberrypi:~ $
```

#### 配置允许使用 root 用户 ssh 连接<br>
> 为了操作方便我先换成 root 用户并且安装了一个 vim 【因为是新装的系统
```sh
pi@raspberrypi:~ $ su
Password:
root@raspberrypi:/home/pi# apt install vim -y
```

1. 打开配置文件
```sh
vim /etc/ssh/sshd_config
```
vim 用的不熟的同学看看 [猹的小教程](https://blog.zinchon.cn/2019/09/ServerStudy-Linux/#vim-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C)
2. 找到 `PermitRootLogin` ，将这里改成这样【建议不熟悉的同学新添加一行不要修改原来的注释内容
```
PermitRootLogin yes # 允许 root 用户登录
```
3. 保存文件并退出后，**记 得 重 启 ！** 【猹刚刚改了半天都连不上最后发现需要重启一下=w=
```sh
reboot
```

之后就可以愉快的用 root 登录辣，其实还有一些 [拿到新系统的基础操作](https://blog.zinchon.cn/2020/03/ServerStudy2/#%E5%B7%B2%E7%BB%8F%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%85%AC%E9%92%A5%E7%99%BB%E5%BD%95) ，不过这就是linux的东西了

到此，拿到树莓派应该做的事就结束辣~

树莓派作为一个可以运行 linux 系统的小主板，可以制作自己的小型博客服务器，云数据库等；还可以接上各种传感器、显示器、驱动器之类的硬件模块，做出各种各样的东西，车啊，飞机啊，魔镜啊啥的，网上多的是；还可以制作一台路由器，个人影院啥的。反正树莓派真是个好东西=w=
